<html>
  <head>
  </head>
  <body>
      <cast-media-player id="player"></cast-media-player>
      <style>
        #player {
            --theme-hue: 210;
            --progress-color: rgb(0, 255, 0);
            --splash-image: url('splash.JPG');
            --background-image: url('splash.JPG');
            --logo-image: url('splash.JPG');
            --watermark-image: url('splash.JPG');
            --spinner-image: url('splash.JPG');
            --buffering-image: url('splash.JPG');
            --pause-image: url('splash.JPG');
            --play-image: url('splash.JPG');
            --break-color:	rgb(255, 0, 0);
        }
      </style>
          <script type="text/javascript"
          src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
    </script>
    <script>

      const context = cast.framework.CastReceiverContext.getInstance();
      const playerManager = context.getPlayerManager();
      const playbackConfig = new cast.framework.PlaybackConfig();
      const networkRequest = new cast.framework.NetworkRequestInfo();
      const castReceiverOptions = new cast.framework.CastReceiverOptions();


      console.log("--- Initialize test 16 ---");

      castReceiverOptions.useLegacyDashSupport = true;
      
      playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, loadRequestData => {
      console.log("--- MessageInterceptor 1 ---");
      // console.log("--- LoadRequestData type: "+loadRequestData.customdata.type);

      console.log("--- LoadRequestData credentials: "+loadRequestData.credentials);
      console.log("--- LoadRequestData credentialsType: "+loadRequestData.credentialsType);
      console.log("--- LoadRequestData customData: "+loadRequestData.customData);
      console.log("--- LoadRequestData customData manifestUrl: "+loadRequestData.customData.manifestUrl);
      console.log("--- LoadRequestData customData type: "+loadRequestData.customData.type);
      console.log("--- LoadRequestData customData mediaSelfLink: "+loadRequestData.customData.mediaSelfLink);
      console.log("--- LoadRequestData customData entitlement DRM Cookie Href: "+loadRequestData.customData.entitlement.DRM.Cookie.Href);

      console.log("--- LoadRequestData media contentUrl: "+loadRequestData.media.contentUrl);
      console.log("--- LoadRequestData media contentId: "+loadRequestData.media.contentId);
      console.log("--- LoadRequestData media contentType: "+loadRequestData.media.contentType);
      console.log("--- LoadRequestData media streamType: "+loadRequestData.media.streamType);
      // console.log("--- LoadRequestData media contentType: "+loadRequestData.media.contentType);

      playbackConfig.licenseUrl = loadRequestData.customData.entitlement.DRM.Cookie.Href
      playbackConfig.protectionSystem = "WIDEVINE";
      playbackConfig.LoggerLevel = "DEBUG";



      console.log("--- MessageInterceptor 2 ---");

      if (loadRequestData.media && loadRequestData.media.entity) {
        console.log("--- MessageInterceptor 3 ---");

        return thirdparty
            .getMediaById(
                loadRequestData.media.entity, loadRequestData.credentials)
            .then(media => {
              if (media) {
                loadRequestData.media.contentId = media.url;
                loadRequestData.media.contentType = media.contentType;
                loadRequestData.media.metadata = media.metadata;
              }
              return loadRequestData;
            });
      }
      return loadRequestData;
      });

      playbackConfig.licenseRequestHandler = requestInfo => {
        console.log("--- licenseRequestHandler requestInfo: ");
        // requestInfo.withCredentials = true;
    
      };

      playbackConfig.licenseHandler = licenseHandler => {
        console.log("--- licenseHandler licenseHandler: ");
        
      };


      context.start({playbackConfig: playbackConfig});

    </script>
  </body>
  </html>